<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('./partials/head', { title: 'Shared: ' + folder.name }) %>
</head>
<body>
    <!-- Minimal Header (no navbar) -->
    <div style="background: var(--bg-card); border-bottom: 2px solid var(--border); padding: 16px 0;">
        <div class="container">
            <h1 style="font-size: 1.3rem; color: var(--text-primary); font-weight: 700; margin-bottom: 8px;">
                Shared Folder: <%= folder.name %>
            </h1>
            <p style="font-size: 0.8rem; color: var(--text-secondary);">
                This link expires on <strong><%= new Date(shareLink.expiresAt).toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }) %></strong>
            </p>
        </div>
    </div>

    <div class="container">
        <main class="drive-content" id="main-content">
            <!-- Breadcrumb - simplified for shared view -->
            <nav class="breadcrumb" aria-label="Breadcrumb">
                <span class="current" aria-current="page">Shared: <%= folder.name %></span>
            </nav>

            <!-- Messages -->
            <% if (typeof error !== 'undefined' && error) { %>
                <div class="alert alert-error" role="alert">
                    <div class="alert-content">
                        <p><%= error %></p>
                    </div>
                    <button type="button" class="alert-close" aria-label="Close alert" onclick="this.parentElement.remove()">
                        √ó
                    </button>
                </div>
            <% } %>

            <% if (typeof success !== 'undefined' && success) { %>
                <div class="alert alert-success" role="alert">
                    <div class="alert-content">
                        <p><%= success %></p>
                    </div>
                    <button type="button" class="alert-close" aria-label="Close alert" onclick="this.parentElement.remove()">
                        √ó
                    </button>
                </div>
            <% } %>

            <!-- Subfolders (read-only) -->
            <% if (subfolders && subfolders.length > 0) { %>
                <section class="content-section" aria-labelledby="subfolders-heading">
                    <h2 class="section-title" id="subfolders-heading">Subfolders (<%= subfolders.length %>)</h2>
                    <div class="folders-grid" role="list">
                        <% subfolders.forEach(subfolder => { %>
                            <div class="folder-card" role="listitem" style="cursor: default;">
                                <div style="pointer-events: none;">
                                    <div class="folder-icon-large" aria-hidden="true">üìÅ</div>
                                    <div class="folder-name"><%= subfolder.name %></div>
                                    <div class="folder-meta"><%= subfolder._count.files %> files</div>
                                </div>
                                <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border); text-align: center;">
                                    <p style="font-size: 0.7rem; color: var(--text-muted);">
                                        <a 
                                        href="/share/<%= shareId %>/folders/<%= subfolder.id %>" 
                                        class="btn btn-secondary btn-sm"
                                        aria-label="View subfolder <%= subfolder.name %>"
                                        >
                                        View
                                        </a>
                                    </p>
                                </div>
                            </div>
                        <% }); %>
                    </div>
                </section>
            <% } %>

            <!-- Files Table -->
            <% if (files && files.length > 0) { %>
                <section class="content-section" aria-labelledby="files-heading">
                    <h2 class="section-title" id="files-heading">Files (<%= files.length %>)</h2>
                    <div class="table-responsive">
                        <table class="files-table">
                            <thead>
                                <tr>
                                    <th scope="col" class="col-icon"><span class="sr-only">File type</span></th>
                                    <th scope="col" class="col-name">Name</th>
                                    <th scope="col" class="col-size">Size</th>
                                    <th scope="col" class="col-date">Uploaded</th>
                                    <th scope="col" class="col-actions">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% files.forEach(file => { %>
                                    <tr class="file-row">
                                        <td class="file-icon" aria-hidden="true">
                                            <% if (file.mimeType.startsWith('image/')) { %>
                                                üñºÔ∏è
                                            <% } else if (file.mimeType === 'application/pdf') { %>
                                                üìÑ
                                            <% } else if (file.mimeType.includes('text')) { %>
                                                üìù
                                            <% } else if (file.mimeType.includes('word')) { %>
                                                üìò
                                            <% } else { %>
                                                üìé
                                            <% } %>
                                        </td>
                                        <td class="file-name"><%= file.name %></td>
                                        <td class="file-size">
                                            <% if (file.size < 1024) { %>
                                                <%= file.size %> B
                                            <% } else if (file.size < 1024 * 1024) { %>
                                                <%= (file.size / 1024).toFixed(1) %> KB
                                            <% } else { %>
                                                <%= (file.size / (1024 * 1024)).toFixed(1) %> MB
                                            <% } %>
                                        </td>
                                        <td class="file-date">
                                            <%= new Date(file.createdAt).toLocaleDateString('en-US', { 
                                                year: 'numeric', 
                                                month: 'short', 
                                                day: 'numeric' 
                                            }) %>
                                        </td>
                                        <td class="file-actions">
                                            <a 
                                                href="/share/<%= shareId %>/files/<%= file.id %>/download" 
                                                class="btn btn-primary btn-sm"
                                                aria-label="Download <%= file.name %>"
                                            >
                                                Download
                                            </a>
                                        </td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    </div>
                </section>
            <% } %>

            <!-- Empty State -->
            <% if ((!subfolders || subfolders.length === 0) && (!files || files.length === 0)) { %>
                <div class="empty-state">
                    <div class="empty-icon" aria-hidden="true">üìÇ</div>
                    <h3>This shared folder is empty</h3>
                    <p class="text-muted">No files or folders to display</p>
                </div>
            <% } %>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-dismiss alerts after 5 seconds
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                setTimeout(() => {
                    if (alert.parentElement) {
                        alert.remove();
                    }
                }, 5000);
            });
        });
    </script>
</body>
</html>